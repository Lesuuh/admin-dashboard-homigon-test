// DATA
const data = [
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },

  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },

  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },

  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },

  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },

  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },

  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 1,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 2,
    nameOnAccount: "Jane Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },

  {
    id: 3,
    nameOnAccount: "Smith Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Individual",
  },
  {
    id: 4,
    nameOnAccount: "Lambert Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 5,
    nameOnAccount: "Peter Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Individual",
  },
  {
    id: 6,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 7,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Individual",
  },
  {
    id: 8,
    nameOnAccount: "John Doe",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
  {
    id: 8,
    nameOnAccount: "Lenard",
    phonenumber: "08123456789",
    email: "personsname@gmail.com",
    dob: "DD/MM/YYYY",
    type: "Agent",
  },
];

const itemsPerPage = 5;

const totalPages = Math.ceil(data.length / itemsPerPage);

let currentPage = 1;

// ---------------- DYNAMIC RENDERING -----------------
const tableBody = document.querySelector("#tbody");
const paginationElement = document.querySelector(".pagination ul");

// Function to render the table data
function renderData() {
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const rows = data.slice(startIndex, endIndex).map(
    (item) => `
      <tr class="table-row">
        <td class="nameonaccount">
          <a href="agents-profile.html">${item.nameOnAccount}</a>
        </td>
        <td>${item.phonenumber}</td>
        <td>${item.email}</td>
        <td>${item.dob}</td>
        <td>${item.type}</td>
        <td id="closest-container">
          <span class="material-icons-outlined more-vert" id="more-vert">more_vert</span>
          <ul id="edit-delete">
            <li class="edit">Delete</li>
            <li class="delete">Edit</li>
          </ul>
        </td>
      </tr>
    `
  );
  tableBody.innerHTML = rows.join("");
}

// Pagination

function createPagination(totalPages, currentPage) {
  let liTag = "";

  if (totalPages <= 5) {
    for (let page = 1; page <= totalPages; page++) {
      const active = page === currentPage ? "active" : "";
      liTag += `<li class="${active}"><span>${page}</span></li>`;
    }
  } else {
    liTag += `<li class="btn prev" onclick="changePage(${
      currentPage - 1
    })"><span>&#60</span></li>`;

    if (currentPage > 2) {
      liTag += `<li><span>1</span></li>`;
      if (currentPage > 3) {
        liTag += `<li class="dots"><span>...</span></li>`;
      }
    }

    for (let page = currentPage - 1; page <= currentPage + 1; page++) {
      if (page >= 1 && page <= totalPages) {
        const active = page === currentPage ? "active" : "";
        liTag += `<li class="numb ${active}" onclick="changePage(${page})"><span>${page}</span></li>`;
      }
    }

    if (currentPage < totalPages - 1) {
      if (currentPage < totalPages - 2) {
        liTag += `<li class="dots"><span>...</span></li>`;
      }
      liTag += `<li class="numb" onclick="changePage(${totalPages})"><span>${totalPages}</span></li>`;
    }
  }

  liTag += `<li class="btn next" onclick="changePage(${
    currentPage + 1
  })"><span>></span></li>`;

  paginationElement.innerHTML = liTag;
}

function changePage(newPage) {
  if (newPage < 1 || newPage > totalPages) {
    return;
  }

  currentPage = newPage;
  renderData();
  createPagination(totalPages, currentPage);
}

tableBody.addEventListener("click", (e) => {
  let openEditDelete = null;
  if (e.target.classList.contains("more-vert")) {
    const icon = e.target;
    const parentContainer = icon.closest("#closest-container");
    const editDelete = parentContainer.querySelector("#edit-delete");

    if (openEditDelete && openEditDelete !== editDelete) {
      openEditDelete.style.display = "none";
    }

    editDelete.style.display =
      editDelete.style.display === "block" ? "none" : "block";

    openEditDelete = editDelete.style.display === "block" ? editDelete : null;

    e.stopPropagation();
  }
});

document.addEventListener("click", (event) => {
  const editDeletes = document.querySelectorAll("#edit-delete");
  editDeletes.forEach((editDelete) => {
    if (!editDelete.contains(event.target)) {
      editDelete.style.display = "none";
    }
  });
});

document.addEventListener("DOMContentLoaded", function () {
  renderData();
  createPagination(totalPages, currentPage);
});

// SEARCH FUNCTIONALITY

// function searchFunction() {
//   const searchInput = document.getElementById("search-input");
//   const rows = tableBody.querySelectorAll("tr");
//   // console.log(rows);

//   searchInput.addEventListener("keyup", function (event) {
//     // console.log(event)
//     const q = event.target.value.toLowerCase();

//     rows.forEach((row) => {
//       // console.log(row)
//       row.querySelector("td").textContent.toLowerCase().startsWith(q)
//         ? (row.style.display = "table-row")
//         : (row.style.display = "none");
//     });
//   });
// }

// ----------------FILTER MODAL-------------------
const openFilter = document.querySelector("#open-filter");
const filterModal = document.querySelector(".filter-modal");

// console.log(filterModal)
// filterModal.style.display = "none";

openFilter.addEventListener("click", (event) => {
  event.stopPropagation();
  filterModal.style.display = "flex";
});

window.addEventListener("click", (event) => {
  if (event.target !== filterModal && !filterModal.contains(event.target)) {
    filterModal.style.display = "none";
  }
});

// CREATE ACCOUNT MODAL
const createAccountModal = document.querySelector(".create-account-modal");
const createAccountModalContent = document.querySelector(
  ".create-account-modal-content"
);
const createAccountBtn = document.getElementById("add-account");

createAccountBtn.addEventListener("click", (event) => {
  createAccountModal.style.display = "flex";
  backdrop.style.display = "flex";
});

function closeModal() {
  createAccountModal.style.display = "none";
  successModal.style.display = "none";
}

document.addEventListener("click", (event) => {
  if (
    event.target === createAccountModal &&
    !createAccountModalContent.contains(event.target)
  ) {
    closeModal();
  }
});

document.addEventListener("keydown", (event) => {
  if (event.key === "Escape") {
    closeModal();
  }
});

// SUCCESS MODAL
const successModal = document.querySelector(".success-modal");
const successModalContent = document.querySelector(".success-modal-content");
const submitBtn = document.querySelector("#submit-btn");

submitBtn.addEventListener("click", () => {
  successModal.style.display = "flex";
  createAccountModal.style.display = "none";
});

document.addEventListener("click", (event) => {
  if (
    event.target === successModal &&
    !successModalContent.contains(event.target)
  ) {
    console.log("wjyyhd");
    closeModal();
  }
});

document.addEventListener("keydown", (event) => {
  if (event.key === "Escape") {
    closeModal();
  }
});



